#!/usr/bin/env bash
set -euo pipefail

here_dir="$(cd -- "$(dirname -- "${BASH_SOURCE[0]}")" && pwd)"
waybar_dir="$(cd -- "${here_dir}/.." && pwd)"
variants_dir="${waybar_dir}/variants"

usage() {
  cat <<'USAGE'
Usage:
  waybar-profile <vertical|horizontal>

This switches Waybar config/style by updating symlinks:
  config.jsonc -> variants/config-<profile>.jsonc
  style.css    -> variants/style-<profile>.css
USAGE
}

if [[ ${#} -ne 1 ]]; then
  usage
  exit 2
fi

profile="${1}"
case "${profile}" in
  vertical|horizontal) ;;
  *)
    usage
    exit 2
    ;;
esac

cfg_src="${variants_dir}/config-${profile}.jsonc"
css_src="${variants_dir}/style-${profile}.css"

if [[ ! -f "${cfg_src}" ]]; then
  echo "Missing: ${cfg_src}" >&2
  exit 1
fi
if [[ ! -f "${css_src}" ]]; then
  echo "Missing: ${css_src}" >&2
  exit 1
fi

ln -sfn "${cfg_src}" "${waybar_dir}/config.jsonc"
ln -sfn "${css_src}" "${waybar_dir}/style.css"

echo "Waybar profile set to: ${profile}"
